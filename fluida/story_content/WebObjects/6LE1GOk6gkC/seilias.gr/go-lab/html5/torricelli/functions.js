/*!
* © by Sitsanlis Ilias
* This notice shall be included in all copies or substantial portions of the Software.
* Creative Commons 4.0/CC BY - NC - SA 4.0. 
*/

function rnd(e,t){return Math.floor(Math.random()*(t-e+1))+e}function toExp(e){for(var t=e.toExponential(1),a=t.indexOf("e"),r=t.substr(0,a),i=t.substr(a+2),n="",s=t.substr(a+1,1),o=0;o<=i.length-1;o++){var h=i.substr(o,1);if("0"==h)return r;n+="1"==h?"¹":"2"==h?"²":"3"==h?"³":String.fromCharCode("0x207"+h)}return r+"·10"+("-"==s?"⁻":"")+n}function sngNumber(e){return e<=0?e.toString():"+"+e.toString()}function makeDragLine(e,t,a){null==e&&(e="#000000"),null==t&&(t="dragPoint"),null==a&&(a=100);var r=new createjs.Shape,i=r.graphics;return i.setStrokeStyle(2),i.beginStroke(e),i.mt(0,0).lt(0,a),i.endStroke(),i.endFill(),r.hitArea=new createjs.Shape,r.hitArea.graphics.setStrokeStyle(2),r.hitArea.graphics.beginStroke("#FFFFFF"),r.hitArea.graphics.beginFill("#FFFFFF"),r.hitArea.graphics.dr(-20,0,40,a),r.hitArea.graphics.endFill(),r.hitArea.graphics.endStroke(),r.hitArea.alpha=.1,r.name=t,r}function makeDragPoint(e,t,a){null==e&&(e="#000000"),null==t&&(t="dragPoint"),null==a&&(a=5);var r=new createjs.Shape,i=r.graphics;return i.setStrokeStyle(1),i.beginStroke(e),i.beginFill(e),i.dc(0,0,a),i.endStroke(),i.endFill(),r.hitArea=new createjs.Shape,r.hitArea.graphics.beginStroke("#FFFFFF"),r.hitArea.graphics.beginFill("#FFFFFF"),r.hitArea.graphics.dc(0,0,20),r.hitArea.graphics.endStroke(),r.hitArea.alpha=.01,r.name=t,r}function makePoint(e,t,a){null==e&&(e="#000000"),null==t&&(t="dragPoint"),null==a&&(a=5);var r=new createjs.Shape,i=r.graphics;return i.setStrokeStyle(1),i.beginStroke(e),i.beginFill(e),i.dc(0,0,a),i.endStroke(),i.endFill(),r.name=t,r}function createVector(e,t,a){null==e&&(e="#000000"),null==t&&(t=!1),null==a&&(a=!1);var r=new createjs.Container,i=new createjs.Shape;i=createLineVector(e),r.addChild(i);var n=new createjs.Shape;if(n=createArrowVector(e),r.addChild(n),t){var s=new createjs.Shape;s=createDragLineVector(),r.addChild(s)}if(a){var o=new createjs.Shape;o=createCircleVector(e),r.addChild(o)}return r}function createLineVector(e){null==e&&(e="#000000");var t=new createjs.Shape,a=t.graphics;return a.setStrokeStyle(2.5),a.beginStroke(e),a.moveTo(0,0),a.lineTo(100,0),a.endStroke(),t}function createDragLineVector(){var e=new createjs.Shape,t=e.graphics;return t.setStrokeStyle(25),t.beginStroke("#ffffff"),t.moveTo(0,0),t.lineTo(100,0),t.endStroke(),e.alpha=.01,e.name="dragLine",e}function createCircleVector(e){null==e&&(e="#000000");var t=new createjs.Shape,a=t.graphics;return a.beginFill("#000000"),a.dc(0,0,3),t.name="startVector",t}function createArrowVector(e){null==e&&(e="#000000");var t=new createjs.Shape,a=t.graphics;return a.setStrokeStyle(1.5,"round","round"),a.beginStroke(e),a.beginFill(e),a.moveTo(0,0),a.lineTo(8*Math.cos(155*toRad),-8*Math.sin(155*toRad)),a.lineTo(-5.5,0),a.lineTo(8*Math.cos(205*toRad),-8*Math.sin(205*toRad)),a.closePath(),a.endFill(),a.endStroke(),t}function updateTextVector(e,t,a,r){var i=t.rotation;arrowVec=t.getChildAt(1),(n=arrowVec.x)<0&&(n=Math.abs(n),i+=180);var n,s=(n=Math.abs(n))*Math.cos(i*toRad),o=n*Math.sin(i*toRad),h=t.x+s+a*Math.cos(i*toRad)+r*Math.cos((i+90)*toRad),c=t.y+o+a*Math.sin(i*toRad)+r*Math.sin((i+90)*toRad);e.x=h,e.y=c,e.textBaseline="alphabetic",e.textAlign="center",Math.abs(n)<5?e.alpha=0:e.alpha=1}function mouseDownVector(e){e.target.addEventListener("pressmove",pressMoveVector)}function pressMoveVector(e){var t=canvas.width;canvas.height;if("vVec"==e.target.name){if(x=Number(x.toFixed(3)),v=Number(((e.stageX*(720/t)-e.target.x)/(vScale*vectorScale)).toFixed(1)),A=Number(Math.sqrt(x*x+v/ω*(v/ω)).toFixed(1)),2<A||isNaN(A)){A=2;var a=ω*Math.sqrt(A*A-x*x);0<v?v=a:v=-a}$("#ASpinner").spinner().val(A),$("#ASlider").slider({value:A});var r=$("#files").val();0==x&&0<v?($("#files").val("0"),φ0=0):0==x&&v<0?($("#files").val("6"),φ0=Math.PI):φ0=Math.atan2(ω*x,v),r!=$("#files").val()&&$("#files").selectmenu("refresh")}restart()}function pressUpVector(e){e.target.removeEventListener("pressmove",pressMoveVector)}function fixPeriod(e,t){return e-t*Math.floor(e/t)}createjs.Container.prototype.setScaleX=function(e){var t,a=this.getChildAt(0),r=this.getChildAt(1),i=this.getChildByName("dragLine");this.getChildByName("startVector");t=(r.x=e)<0?-1:1,25<=Math.abs(e)?(r.scaleX=t,a.scaleX=(e-t)/100,null!=i&&(i.scaleX=(e-t)/100)):(r.scaleX=4*e/100,a.scaleX=e/100-4*e/100/100,null!=i&&(i.scaleX=e/100-4*e/100/100))};var shifted=!(createjs.Container.prototype.drawDistance=function(e,t,a,r,i,n,s){null==e&&(e="#000000"),this.removeAllChildren();var o=new createjs.Shape;this.addChild(o);var h=o.graphics;h.clear();var c=Math.sqrt((r-t)*(r-t)+(i-a)*(i-a)),l=Math.atan2(-(i-a),r-t);if(40<c){var d=8*(25<c?1:4*c/100);h.setStrokeStyle(1,"round","round"),h.beginStroke(e),h.mt(d*Math.cos(25*toRad),-d*Math.sin(25*toRad)).lt(0,0).lt(d*Math.cos(25*toRad),+d*Math.sin(25*toRad)),h.mt(0,0).lt(c,0).lt(c+d*Math.cos(155*toRad),-d*Math.sin(155*toRad)).mt(c,0).lt(c+d*Math.cos(205*toRad),-d*Math.sin(205*toRad)),h.setStrokeStyle(1),h.setStrokeDash([2,2],2),h.beginStroke(e),h.mt(0,n/2).lt(0,-n/2),h.mt(c,n/2).lt(c,-n/2),h.endStroke(),o.rotation=-l*toDeg,o.regX=n*Math.cos(Math.PI/2),o.regY=-n*Math.sin(Math.PI/2),o.x=t,o.y=a;var g=new createjs.Text(s,"12px Trebuchet MS");g.set({x:(t+r)/2-34,y:(a+i)/2+2,rotation:l*toDeg,textAlign:"center"}),this.addChild(g)}});$(document).on("keyup keydown",function(e){shifted=e.shiftKey}),createjs.Container.prototype.slider=function(s){var e=new createjs.Shape,a=e.graphics;this.addChild(e);canvas.width,canvas.height;a.setStrokeStyle(1),a.beginStroke("#aaa");for(var r=s/12,i=0;i<=12;i++)a.mt(i*r,-2).lt(i*r,-6);a.beginFill("#eee"),a.r(0,-2,s,4),a.endFill(),e.hitArea=new createjs.Shape,e.hitArea.graphics.beginStroke("#FFFFFF"),e.hitArea.graphics.beginFill("#FFFFFF"),e.hitArea.graphics.r(0,-10,s,20),e.hitArea.graphics.endStroke(),e.hitArea.alpha=.01;var n=new createjs.Shape;this.addChild(n),(a=n.graphics).setStrokeStyle(1),a.beginStroke("#aaa"),a.beginFill("#eee"),a.r(-4,-4,8,8),n.hitArea=new createjs.Shape,n.hitArea.graphics.beginStroke("#FFFFFF"),n.hitArea.graphics.beginFill("#FFFFFF"),n.hitArea.graphics.dc(0,0,20),n.hitArea.graphics.endStroke(),n.hitArea.alpha=.01;for(i=0;i<=4;i++){if(0==i)var o=new createjs.Text("0","10px Trebuchet MS","#666666");else if(1==i)o=new createjs.Text("T/4","10px Trebuchet MS","#666666");else if(2==i)o=new createjs.Text("T/2","10px Trebuchet MS","#666666");else if(3==i)o=new createjs.Text("3T/4","10px Trebuchet MS","#666666");else if(4==i)o=new createjs.Text("T","10px Trebuchet MS","#666666");o.set({textAlign:"center"}),o.x=i*s/4,o.y=-18,this.addChild(o)}function h(e){var a=canvas.width,r=canvas.height,i=e.stageX*(720/a)+e.target.offset.x;e.stageY,e.target.offset.y;i<0&&(i=0),s<i&&(i=s),t=T*(e.target.kT+i/s),calculations(),positions()}e.on("click",function(e){if(!isNaN(T)&&isFinite(T)){var a=canvas.width,r=Math.floor(t/T);t=T*(r+(e.stageX*(720/a)-160)/s);var i=T/12,n=t-T*r;Math.abs(n-i*Math.round(n/i))<=.05&&(t=T*r+Math.round(n/i)*i),calculations(),positions()}}),n.on("mousedown",function(e){if(!isNaN(T)&&isFinite(T)){var a=canvas.width,r=canvas.height;e.target.offset={x:e.target.x-e.stageX*(720/a),y:e.target.y-e.stageY*(420/r)},e.target.addEventListener("pressmove",h),e.target.kT=Math.floor(t/T)}}),n.on("pressup",function(e){if(!isNaN(T)&&isFinite(T)){if(e.target.x==s&&(e.target.x=0),!shifted){var a=T/12,r=t-T*e.target.kT,i=Math.abs(r-a*Math.round(r/a));Math.abs(t-T*Math.round(t/T))<1e-10?t=T*Math.round(t/T)+1e-10:i<=a/2&&(t=a*Math.round(t/a))}calculations(),positions(),e.target.removeEventListener("pressmove",h)}})},createjs.Shape.prototype.addArrow=function(e,t,a,r){var i=this.graphics;i.ss(1),i.s(e),i.mt(t,a).lt(t+8*Math.cos((155+r)*toRad),a-8*Math.sin((155+r)*toRad)).mt(t,a).lt(t+8*Math.cos((205+r)*toRad),a-8*Math.sin((205+r)*toRad))},createjs.Container.prototype.xAxisCreate=function(e,t,a,r){var i="#666";this.removeAllChildren();var n=new createjs.Shape;n.graphics.ss(2).s(i).mt(e*r-10,0).lt(t*r+15,0).dc(0,0,2),n.addArrow(i,t*r+15,0,0),n.graphics.s(1).ss(i);for(var s=e;s<=t;s+=a){if(0!=s&&n.graphics.mt(s*r,0).lt(s*r,5),s<Math.round(t)-1)for(var o=.2;o<1;o+=.2)n.graphics.mt((s+o)*r,0).lt((s+o)*r,3);var h=new createjs.Text(s.toFixed(0),"10px Trebuchet MS",i);h.set({textAlign:"center"}),h.x=s*r,h.y=8,this.addChild(h)}this.addChild(n)};